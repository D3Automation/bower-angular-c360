/**
 * angular-c360 - Angular components for working with data from Configurator 360
 * @version v0.6.1
 * (c) 2016 D3 Automation  http://d3tech.net/solutions/automation/
 * License: MIT
 */
function UIProperty(e,t,r){this.c360Context=e,this.hostPart=t,this.adeskProp=r,this.parseTooltip(),this.parseChoiceList()}!function(){angular.module("angular-c360",["breeze.angular"])}(),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var r=this.toString();(void 0===t||t>r.length)&&(t=r.length),t-=e.length;var n=r.indexOf(e,t);return-1!==n&&n===t}}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t}),Object.defineProperty(UIProperty.prototype,"category",{get:function(){return this.adeskProp.Category},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"choiceList",{get:function(){return this.choiceListData},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"choiceListDisplayMode",{get:function(){return this.adeskProp.ChoiceListDisplayMode},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"customData",{get:function(){return this.customDataValue},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"dataType",{get:function(){return this.dataTypeValue},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"errorInfo",{get:function(){return this.adeskProp.ErrorInfo},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"fullName",{get:function(){return this.adeskProp.FullName},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"inputType",{get:function(){return"date"===this.dataType?"date":"boolean"===this.dataType?"checkbox":"integer"===this.dataType||"number"===this.dataType?"number":"text"},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"invParamName",{get:function(){return this.adeskProp.InvParamName},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"isCheckbox",{get:function(){return"boolean"===this.dataType},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"isLocked",{get:function(){return this.adeskProp.IsLocked},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"isModified",{get:function(){return this.adeskProp.IsModified},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"isReadOnly",{get:function(){return this.adeskProp.IsReadOnly},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"part",{get:function(){return this.hostPart},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"precision",{get:function(){return this.adeskProp.Precision},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"restrictToList",{get:function(){return this.adeskProp.RestrictToList},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"sequence",{get:function(){return this.adeskProp.Sequence},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"tooltip",{get:function(){return this.adeskProp.Tooltip},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"uiRuleName",{get:function(){return this.adeskProp.UiRuleName},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"value",{get:function(){return this.adeskProp.Value},set:function(e){this.adeskProp.Value=e,this.c360Context.updateProperty(this.part.refChain,this.uiRuleName,e)},enumerable:!0,configurable:!0}),Object.defineProperty(UIProperty.prototype,"hasChoiceList",{get:function(){return this.choiceList&&this.choiceList.length>0},enumerable:!0,configurable:!0}),UIProperty.prototype.reset=function(){this.c360Context.resetProperty(this.part.refChain,this.uiRuleName)},UIProperty.prototype.parseChoiceList=function(){if(this.adeskProp.ChoiceList){var e=this;this.choiceListData=this.adeskProp.ChoiceList.map(function(t){return{value:e.convertChoiceListValue(t.DisplayString),text:t.DisplayString}})}},UIProperty.prototype.parseTooltip=function(){try{var e=JSON.parse(this.adeskProp.Tooltip);this.toolTipValue=e.ToolTip,this.dataTypeValue=e.DataType.toLowerCase(),this.customDataValue=e.CustomData}catch(t){this.dataTypeValue=this.getDataTypeFromValue()}},UIProperty.prototype.getDataTypeFromValue=function(){return"number"==typeof this.value?"number":this.value instanceof Date?"date":"boolean"==typeof this.value?"boolean":"string"},UIProperty.prototype.convertChoiceListValue=function(e){switch(this.dataType){case"string":return e;case"number":return parseFloat(e);case"integer":return parseInt(e);case"boolean":return"True"===e||"true"===e;default:return e}},function(){"use strict";function e(e,t){var r="c360Prop.html";try{r=t.get("c360PropTemplateUrl")}catch(n){}return{restrict:"E",scope:{uiProp:"=",labelText:"@"},controller:["$scope",function(e){function t(){e.uiProp&&!e.labelText&&(e.labelText=e.uiProp.fullName)}t(),e.$watch("uiProp",function(e,r){t()})}],templateUrl:r}}angular.module("angular-c360").directive("c360Prop",e),e.$inject=["$compile","$injector"]}(),function(){"use strict";function e(e,t,r){var n="c360Viewer";return{restrict:"E",link:function(i,o,a,u){function c(){function e(e){for(var t=e.offsetParent,r={top:e.offsetTop,left:e.offsetLeft};null!==t;)r.top+=t.offsetTop,r.left+=t.offsetLeft,t=t.offsetParent;return r}var t=o[0].clientWidth+"px",r=o[0].clientHeight+"px",n=e(o[0]);l.style.zIndex="1",l.style.top=n.top+"px",l.style.left=n.left+"px",l.style.width=t,l.style.height=r;var i=l.firstElementChild;i.style.width=t,i.style.height=r}var l=document.getElementById(n);r.componentElement=o,i.$on("$destroy",function(t){e.addEventListener("resize",null,!1),r.componentElement===o&&(l.style.top="0",l.style.left="0",l.style.zIndex="-1",r.componentElement=void 0)}),e.addEventListener("resize",c,!1),t(function(){c()},100)}}}angular.module("angular-c360").directive("c360Viewer",e),e.$inject=["$window","$timeout","c360ViewerUtils"]}(),function(){"use strict";function e(){function e(e,n,i,o,a,u,c,l,s){function p(){i.initialize(A.metadataStore)}function f(){return E()}function d(e){return E(e)}function y(){return S}function h(){return A.getEntities("UIPart")}function m(e){return A.getEntityByKey("UIPart",e)}function g(e,t,r){function i(e){O(e),w(!0),c.resolve()}function u(e){n.error("","Error updating property"),k(e),c.reject()}$=!0;var c=o.defer();return a.$broadcast("C360ModelUpdating",{promise:c.promise}),z.setPropertyValues({refChain:e,properties:[{name:t,value:r}]},i,u),c.promise}function P(e){function t(e){O(e),w(!0),i.resolve()}function r(e){n.error("","Error updating property"),k(e),i.reject()}$=!0;var i=o.defer();return a.$broadcast("C360ModelUpdating",{promise:i.promise}),z.setPropertyValues(e,t,r),i.promise}function b(e,t){return g(e,t,null)}function v(e){function t(){z.executeAction(e,r,i),a.$broadcast("C360ActionExecuting",{promise:u.promise})}function r(e){var t=null;if(e.url){var r=document.createElement("iframe");r.setAttribute("src",e.url),r.style.display="none",document.body.appendChild(r),s(function(){r.remove()},1e3),u.resolve()}else if(angular.isDefined(e.title)&&angular.isDefined(e.message)){var t=null;try{t=JSON.parse(e.message)}catch(n){t=e.message}u.resolve(t)}else O(e),w(!0),u.resolve()}function i(t){n.error("","Error occurred while executing action "+e.name),k(payload.data),u.reject(t)}if(D)return n.info("Unable to execute action "+e.name+" while another action is in progress"),o.reject();n.info("Executing action "+e.name);var u=o.defer();return D=!0,u.promise["finally"](function(){D=!1}),e.params?z.setPropertyValues({uiActionParams:JSON.stringify(e.params)},function(){t()}):t(),u.promise}function C(){j()}function I(){return M}function U(){return null!==S}function T(e){e.invalidCharacterReplacement&&angular.isString(e.invalidCharacterReplacement)&&(R.invalidCharacterReplacement=e.invalidCharacterReplacement),e.visitPart&&angular.isFunction(e.visitPart)&&(R.visitPart=e.visitPart),e.isPartCollection&&angular.isFunction(e.isPartCollection)&&(R.isPartCollection=e.isPartCollection),e.parseCollectionName&&angular.isFunction(e.parseCollectionName)&&(R.parseCollectionName=e.parseCollectionName)}function E(e){function t(e){z=e,z.getPropertyValues(null,function(e){O(e),a.$broadcast("C360ModelReset",S),u.resolve(S)})}function n(e){z=e,u.reject(e.state)}j();var i=document.getElementById(W);i||(i=document.createElement("div"),i.setAttribute("id",W),document.body.insertBefore(i,document.body.firstChild)),i.style.position="absolute",i.style.zIndex="-1";var u=o.defer(),c={container:i,design:r,panes:!1,success:t,error:n,verbose:!0};return e&&(c.openFromFile=e),L.checkCompatibility(function(e){e.compatible?L.initViewer(c):(F=e.reason,u.reject(e.reason))}),u.promise}function O(e){F=null,x(e,e.parentRefChain),e.removedRefChains&&e.removedRefChains.forEach(function(e){var t=m(e);t&&(t.Parent&&t.Parent.hasOwnProperty(t.Name)&&delete t.Parent[t.Name],A.detachEntity(t))}),N(A.getEntities("UIPart")),a.$broadcast("C360ModelUpdated")}function x(t,r){var n=null,i=angular.isDefined(t.isCompleteChangedPart)&&t.isCompleteChangedPart===!0;n={refChain:t.refChain,name:t.Name,partType:t.PartType,parentRefChain:r};var o=A.createEntity("UIPart",n,e.EntityState.Unchanged,e.MergeStrategy.OverwriteChanges);o.actions&&o.actions.forEach(function(e){delete o[e.name]}),o.uiProperties&&o.uiProperties.forEach(function(e){delete o[e.fullName]}),o.uiProperties&&!i||(o.uiProperties=[]),t.properties&&t.properties.forEach(function(e){if(!i)for(var t=0,r=o.uiProperties.length;r>t;t++)if(o.uiProperties[t].fullName===e.value.FullName){o.uiProperties.splice(t,1);break}o.uiProperties.push(new UIProperty(K,o,e.value))}),o.messages=[],t.Messages&&t.Messages.forEach(function(e){o.messages.push({messageText:e.MessageText,severity:e.Severity})}),o.actions=[],t.Actions&&t.Actions.forEach(function(e){o.actions.push({name:e.Name,category:e.Category,menuText:e.MenuText,tooltip:e.tooltip})}),t.children&&t.children.forEach(function(e){x(e,t.refChain)})}function N(e){e.forEach(function(e){if("Root"===e.refChain&&(S=e),e.uiProperties.forEach(function(t){var r=t.fullName.replace(V,R.invalidCharacterReplacement);e[r]=t}),e.children.forEach(function(t){var r=t.name.replace(V,R.invalidCharacterReplacement),n=t;Object.defineProperty(e,r,{get:function(){return n},enumerable:!0,configurable:!0})}),R.isPartCollection(e)){var t=R.parseCollectionName(e.name);Object.defineProperty(e.parent,t,{get:function(){return e.children},enumerable:!0,configurable:!0})}e.actions&&e.actions.forEach(function(t){e[t.name]=function(r){var n={refChain:e.refChain,name:t.name,params:r};return v(n)}})}),e.forEach(function(e){R.visitPart(e)})}function j(){S=null,A.clear(),w(!1),z&&(z.unload(),z=null)}function k(e){var t={code:0,message:"Server Unavailable",details:""};a.$broadcast("C360Error",{error:t})}function w(e){angular.isDefined(e)||(e=!0),M=e}var L=window.ADSK&&window.ADSK.C360,R=new t,S=null,$=!1,D=!1,M=!1,V=/[\s\%\/\?\)\(\.\']/g,A=new e.EntityManager,z=null,F=null,W="c360Viewer";p();var K={getNewModel:f,loadModel:d,getRoot:y,getParts:h,getPartByRefChain:m,updateProperty:g,updateProperties:P,resetProperty:b,executeAction:v,endSession:C,isDirty:I,setDirty:w,isModelLoaded:U,setModelAdapter:T,getViewer:function(){return z},getLastError:function(){return F}};return K}var r="";this.setDesignKey=function(e){r=e},this.$get=e,e.$inject=["breeze","$log","c360Model","$q","$rootScope","$http","$interval","$window","$timeout"]}function t(){function e(e){return e.name.endsWith("Collection")}function t(e){var t=e.replace("Collection",""),r=null;return r=t.endsWith("y")?t.substring(0,t.length-1)+"ies":t+"s"}function r(e){}var n=this;n.invalidCharacterReplacement="",n.visitPart=r,n.isPartCollection=e,n.parseCollectionName=t}angular.module("angular-c360").provider("c360Context",e)}(),function(){function e(){function e(e){e.addEntityType({shortName:"UIPart",namespace:"C360",dataProperties:{refChain:{dataType:t.String,isPartOfKey:!0},name:{dataType:t.String},partType:{dataType:t.String},parentRefChain:{dataType:t.String}},navigationProperties:{parent:{entityTypeName:"UIPart:#C360",isScalar:!0,associationName:"UIPart_UIPart",foreignKeyNames:["parentRefChain"]},children:{entityTypeName:"UIPart:#C360",isScalar:!1,associationName:"UIPart_UIPart"}}})}var t=breeze.DataType;return{initialize:e}}angular.module("angular-c360").factory("c360Model",e)}(),function(){"use strict";function e(){return{componentElement:void 0}}angular.module("angular-c360").factory("c360ViewerUtils",e)}(),angular.module("angular-c360").run(["$templateCache",function(e){e.put("c360Prop.html",'<div ng-if="uiProp"><div ng-if="!uiProp.isCheckbox && uiProp.choiceList == null"><label>{{labelText}}</label><input ng-model="uiProp.value" ng-model-options="{ updateOn: \'blur\' }" placeholder="{{uiProp.fullName}}" ng-class="{ \'c360-modified\': uiProp.isModified, \'c360-invalid\': uiProp.errorInfo }" ng-disabled="uiProp.isReadOnly" type="{{uiProp.inputType}}"></div><div ng-if="uiProp.choiceList != null"><label>{{labelText}}</label><select ng-model="uiProp.value" ng-options="choice.value as choice.text for choice in uiProp.choiceList" ng-class="{ \'c360-modified\': uiProp.isModified, \'c360-invalid\': uiProp.errorInfo }" ng-disabled="uiProp.isReadOnly"></select></div><div ng-if="uiProp.isCheckbox"><label><input ng-model="uiProp.value" placeholder="uiProp.fullName" ng-class="{ \'c360-modified\': uiProp.isModified, \'c360-invalid\': uiProp.errorInfo }" ng-disabled="uiProp.isReadOnly" type="checkbox"> {{labelText}}</label></div></div>')}]);